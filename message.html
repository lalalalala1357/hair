<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>留言管理 - 可莉兒 Hair Salon-管理後台</title>
<style>
:root{
  --bg:#f7fff7;
  --card:#ffffff;
  --accent:#a8e6cf;
  --muted:#666;
  --btn:#ccc;
}
body{font-family:Arial, Helvetica, sans-serif;background:var(--bg);margin:0;padding:0;color:#333}

/* Header / Nav */
header{
  background:#a8e6cf;
  padding:15px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  flex-wrap:wrap;
}
header h1{margin:0;color:#4a7c53;font-weight:bold;font-size:18px;}


nav {
  overflow-x: auto;           /* 超出寬度時水平滑動 */
  overflow-y: hidden;         /* 禁止上下滾動 */
  -webkit-overflow-scrolling: touch; /* 手機滑動順暢 */
}

nav ul{
  list-style:none;
  display:flex;
  gap:12px;
  margin:0;
  padding:0;
  white-space:nowrap;
}
nav a{
  text-decoration:none;
  color:#333;
  font-weight:bold;
  padding:6px 12px;
  border-radius:4px;
  flex-shrink: 0;             /* 防止自動壓縮 */
}
nav a:hover, nav a.active{background:#7bd8a2;color:#fff;}

main { max-width:1000px; margin:40px auto; padding:0 20px; }
h1 { color:#4a7c53; text-align:center; margin-bottom:30px; }

.table-wrapper {
  overflow-x: auto;       /* 超出寬度時可水平滑動 */
  -webkit-overflow-scrolling: touch; /* 手機滑動順暢 */
}

table {
  width:100%;
  min-width: 600px;
  border-collapse: collapse;
  background:var(--card);
  box-shadow:0 2px 8px rgba(0,0,0,0.1);
  border-radius:8px;
  overflow:hidden;
}
th, td {
  border-bottom:1px solid #ccc;
  padding:8px 10px
  ; text-align:left;
}
th {
  background:#7bd8a2;
  color:#fff;
}
tr:nth-child(even) { background:#e6f7ed; }
tr.replied { opacity: 0.6; }
</style>
</head>
<body>

<header>
  <h1>可莉兒 Hair Salon - 管理後台</h1>
  <nav>
    <ul>
      <li><a href="admin-calendar.html">行事曆管理</a></li>
      <li><a href="vip_test.html">VIP管理</a></li>
      <li><a href="admin-news.html">公告管理</a></li>
      <li><a href="message.html" class="active">留言管理</a></li>
    </ul>
  </nav>
</header>

<main>
  <h1>留言管理</h1>
  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>姓名</th>
          <th>聯絡方式</th>
          <th>留言內容</th>
          <th>送出時間</th>
          <th>已查看</th>
          <th>刪除</th> <!-- ✅ 新增 -->
        </tr>
      </thead>
      <tbody id="messages-table">
        <!-- 留言會自動載入 -->
      </tbody>
    </table>
  </div>
</main>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyCfxDOOzTLbmQRfvW275hJrtOnX_t-6-yc",
  authDomain: "hsinformation.firebaseapp.com",
  projectId: "hsinformation",
  storageBucket: "hsinformation.firebasestorage.app",
  messagingSenderId: "245515525647",
  appId: "1:245515525647:web:00bf24514009bddd02cd7a"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const tableBody = document.getElementById('messages-table');

// 讀取留言
db.collection('messages').orderBy('createdAt', 'desc').onSnapshot(snapshot => {
  const messages = [];
  snapshot.forEach(doc => {
    const data = doc.data();
    messages.push({id: doc.id, ...data, replied: data.replied || false});
  });

  // 先把未回覆排上方
  messages.sort((a,b) => a.replied - b.replied);

  tableBody.innerHTML = "";
  messages.forEach(data => {
    const row = document.createElement('tr');
    if(data.replied) row.classList.add('replied');

    // 姓名
    const nameCell = document.createElement('td');
    nameCell.textContent = data.name || '';
    row.appendChild(nameCell);

    // 電子郵件
    const contactCell = document.createElement('td');
    contactCell.textContent = data.contact || '';
    row.appendChild(contactCell);

    // 留言內容
    const messageCell = document.createElement('td');
    messageCell.textContent = data.message || '';
    row.appendChild(messageCell);

    // 送出時間
    const timeCell = document.createElement('td');
    const date = data.createdAt ? data.createdAt.toDate() : new Date();
    timeCell.textContent = date.toLocaleString();
    row.appendChild(timeCell);

    // 已查看勾勾
    const repliedCell = document.createElement('td');
    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.checked = data.replied;
    checkbox.addEventListener('change', async () => {
      await db.collection('messages').doc(data.id).update({replied: checkbox.checked});
    });
    repliedCell.appendChild(checkbox);
    row.appendChild(repliedCell);

    tableBody.appendChild(row);



        // 刪除按鈕
    const deleteCell = document.createElement('td');
    const deleteBtn = document.createElement('button');
    deleteBtn.textContent = '刪除';
    deleteBtn.style.background = '#ff6666';
    deleteBtn.style.color = '#fff';
    deleteBtn.style.border = 'none';
    deleteBtn.style.padding = '5px 10px';
    deleteBtn.style.borderRadius = '5px';
    deleteBtn.style.cursor = 'pointer';
    deleteBtn.addEventListener('click', async () => {
      if (confirm('確定要刪除此留言嗎？')) {
        await db.collection('messages').doc(data.id).delete();
        row.remove(); // 從畫面移除這列
        alert('留言已刪除');
      }
    });
    deleteCell.appendChild(deleteBtn);
    row.appendChild(deleteCell);
  });
});
</script>

</body>
</html>

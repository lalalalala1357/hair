<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>å…¬å‘Šç®¡ç† - å¯è‰å…’ Hair Salon</title>
<style>
:root{
  --bg:#f7fff7;
  --card:#ffffff;
  --accent:#a8e6cf;
  --muted:#666;
  --btn:#ccc;
}
body{font-family:Arial, Helvetica, sans-serif;background:var(--bg);margin:0;padding:0;color:#333}

header{background:#a8e6cf;padding:15px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;}
header h1{margin:0;color:#4a7c53;font-weight:bold;font-size:18px;}
nav ul{list-style:none;display:flex;gap:12px;margin:0;padding:0;overflow-x:auto;white-space:nowrap;-webkit-overflow-scrolling: touch;}
nav a{text-decoration:none;color:#333;font-weight:bold;padding:6px 12px;border-radius:4px;}
nav a:hover, nav a.active{background:#7bd8a2;color:#fff;}

.container{max-width:900px;margin:20px auto;padding:0 20px;}
h1{color:#4a7c53;margin-bottom:20px;text-align:center;}
.card{background:var(--card);border-radius:8px;padding:20px;margin-bottom:12px;box-shadow:0 1px 5px rgba(0,0,0,0.1);position:relative;}
.card h3{margin:0 0 8px;color:#3a6f45;}
.card time{display:block;font-size:0.85rem;color:#777;margin-bottom:10px;}
.card p{font-size:1rem;line-height:1.6;color:#444;}
.card .actions{position:absolute;top:10px;right:10px;display:flex;gap:6px;}
.card .actions button{background:#7bd8a2;color:#fff;border:none;padding:4px 8px;cursor:pointer;border-radius:4px;}
.card .actions button.delete{background:#ff7c7c;}

#addForm, #bannerForm{background:#ffffff;padding:20px;border-radius:8px;margin-bottom:20px;box-shadow:0 1px 5px rgba(0,0,0,0.1);}
#addForm input, #addForm textarea, #bannerForm input, #bannerForm textarea{width:100%;margin-bottom:8px;padding:8px;border-radius:6px;border:1px solid #ddd;font-size:14px;}
#addForm label, #bannerForm label{font-weight:bold;margin-bottom:4px;display:block;}
#addForm button, #bannerForm button{background:#4a7c53;color:#fff;border:none;padding:10px 16px;cursor:pointer;border-radius:6px;}

.toast{position:fixed;right:18px;bottom:18px;background:#222;color:#fff;padding:10px 14px;border-radius:8px}
.hidden{display:none}

/* å‰ç«¯æ©«å¹…ç¤ºç¯„ */
#bannerDisplay{background:#ffe08a;color:#333;padding:12px 16px;border-radius:8px;margin-bottom:20px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 1px 4px rgba(0,0,0,0.15);}
#bannerDisplay button{background:#4a7c53;color:#fff;border:none;padding:4px 8px;cursor:pointer;border-radius:4px;}
</style>
</head>
<body>

<header>
  <h1>å¯è‰å…’ Hair Salon - ç®¡ç†å¾Œå°</h1>
  <nav>
    <ul>
      <li><a href="admin-calendar.html">è¡Œäº‹æ›†ç®¡ç†</a></li>
      <li><a href="vip_test.html">VIPç®¡ç†</a></li>
      <li><a href="admin-news.html" class="active">å…¬å‘Šç®¡ç†</a></li>
    </ul>
  </nav>
</header>

<div class="container">

  <!-- å¯†ç¢¼ç™»å…¥ -->
  <div id="loginCard" class="card">
    <h3>è«‹è¼¸å…¥ç®¡ç†å¯†ç¢¼</h3>
    <input type="password" id="adminPassword" placeholder="ç®¡ç†å¯†ç¢¼">
    <button id="btnLogin">ç™»å…¥</button>
  </div>

  <!-- ä¸»ç•«é¢ -->
  <div id="mainUI" class="hidden">

    <!-- æ©«å¹…å…¬å‘Šå–®ç¨ç·¨è¼¯ -->
    <div id="bannerForm" class="card">
      <h3>æ©«å¹…å…¬å‘Š (å–®ä¸€)</h3>
      <label>æ¨™é¡Œ</label>
      <input type="text" id="bannerTitle" placeholder="æ©«å¹…æ¨™é¡Œ">
      <label>å…§å®¹</label>
      <textarea id="bannerContent" rows="2" placeholder="æ©«å¹…å…§å®¹"></textarea>
      <button id="btnBannerSave">å„²å­˜æ©«å¹…</button>
    </div>

    <!-- æ–°å¢ä¸€èˆ¬å…¬å‘Šè¡¨å–® -->
    <div id="addForm">
      <h3>æ–°å¢ / ç·¨è¼¯å…¬å‘Š</h3>
      <label>æ¨™é¡Œ</label>
      <input type="text" id="titleInput" placeholder="å…¬å‘Šæ¨™é¡Œ">
      <label>å…§å®¹</label>
      <textarea id="contentInput" rows="4" placeholder="å…¬å‘Šå…§å®¹"></textarea>
      <label><input type="checkbox" id="pinnedInput"> ç½®é ‚å…¬å‘Š</label>
      <div style="margin-top:8px;">
        <button id="btnAdd">æ–°å¢å…¬å‘Š</button>
        <button id="btnUpdate" class="hidden">æ›´æ–°å…¬å‘Š</button>
        <button id="btnClear">æ¸…é™¤è¡¨å–®</button>
      </div>
    </div>

    <!-- å…¬å‘Šåˆ—è¡¨ -->
    <div id="articles"></div>

  </div>

</div>

<div id="toast" class="toast hidden">å·²å„²å­˜</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyAXbCW5UXRp085kJc9DjE5z2rbDJNFv47g",
  authDomain: "hair-salon-56eb5.firebaseapp.com",
  projectId: "hair-salon-56eb5",
  storageBucket: "hair-salon-56eb5.firebasestorage.app",
  messagingSenderId: "64472921085",
  appId: "1:64472921085:web:78ba36b069597490625f94",
  measurementId: "G-Z5224KYPR7"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
</script>

<script>
const ADMIN_PASSWORD = "1234";
const loginCard = document.getElementById('loginCard');
const mainUI = document.getElementById('mainUI');
const btnLogin = document.getElementById('btnLogin');

const titleInput = document.getElementById('titleInput');
const contentInput = document.getElementById('contentInput');
const pinnedInput = document.getElementById('pinnedInput');
const btnAdd = document.getElementById('btnAdd');
const btnUpdate = document.getElementById('btnUpdate');
const btnClear = document.getElementById('btnClear');

const bannerTitle = document.getElementById('bannerTitle');
const bannerContent = document.getElementById('bannerContent');
const btnBannerSave = document.getElementById('btnBannerSave');

const articlesDiv = document.getElementById('articles');
const toast = document.getElementById('toast');

let editingDocId = null;

function showToast(msg='å·²å„²å­˜', time=2000){
  toast.textContent = msg;
  toast.classList.remove('hidden');
  setTimeout(()=>toast.classList.add('hidden'), time);
}

// ç™»å…¥æª¢æŸ¥
btnLogin.addEventListener('click', ()=>{
  const val = document.getElementById('adminPassword').value;
  if(val !== ADMIN_PASSWORD){
    alert("å¯†ç¢¼éŒ¯èª¤");
    return;
  }
  loginCard.classList.add('hidden');
  mainUI.classList.remove('hidden');
  loadBanner();
  loadAnnouncements();
});

// ---------- æ©«å¹…å…¬å‘Š ----------
async function loadBanner(){
  const doc = await db.collection("banner").doc("main").get();
  if(doc.exists){
    const data = doc.data();
    bannerTitle.value = data.title || "";
    bannerContent.value = data.content || "";
  }
}
btnBannerSave.addEventListener('click', async ()=>{
  const title = bannerTitle.value.trim();
  const content = bannerContent.value.trim();
  await db.collection("banner").doc("main").set({title, content});
  showToast("æ©«å¹…å…¬å‘Šå·²å„²å­˜");
});

// ---------- ä¸€èˆ¬å…¬å‘Šåˆ—è¡¨ ----------
btnClear.addEventListener('click', ()=>{
  titleInput.value=''; contentInput.value=''; pinnedInput.checked=false;
  editingDocId=null;
  btnUpdate.classList.add('hidden'); btnAdd.classList.remove('hidden');
});

async function loadAnnouncements(){
  articlesDiv.innerHTML="";
  const snapshot = await db.collection("announcements")
    .orderBy("pinned","desc")
    .orderBy("createdAt","desc")
    .get();
  snapshot.forEach((doc)=>{
    const data = doc.data();
    const card = document.createElement('div');
    card.className='card';
    card.innerHTML = `
      <h3>${data.title}</h3>
      <time>${data.createdAt?.toDate().toLocaleDateString() || ""}</time>
      <p>${data.content}</p>
      <div class="actions">
        <button class="edit">âœï¸ ç·¨è¼¯</button>
        <button class="delete">ğŸ—‘ï¸ åˆªé™¤</button>
      </div>
    `;
    articlesDiv.appendChild(card);

    card.querySelector('.edit').onclick = ()=>{
      titleInput.value = data.title;
      contentInput.value = data.content;
      pinnedInput.checked = data.pinned || false;
      editingDocId = doc.id;
      btnUpdate.classList.remove('hidden');
      btnAdd.classList.add('hidden');
    };

    card.querySelector('.delete').onclick = async ()=>{
      if(confirm("ç¢ºå®šè¦åˆªé™¤é€™å‰‡å…¬å‘Šå—ï¼Ÿ")){
        await db.collection("announcements").doc(doc.id).delete();
        showToast("å…¬å‘Šå·²åˆªé™¤");
        loadAnnouncements();
      }
    };
  });
}

// æ–°å¢å…¬å‘Š
btnAdd.addEventListener('click', async ()=>{
  const title = titleInput.value.trim();
  const content = contentInput.value.trim();
  const pinned = pinnedInput.checked;
  if(!title || !content){ alert("è«‹è¼¸å…¥æ¨™é¡Œèˆ‡å…§å®¹"); return; }

  await db.collection("announcements").add({
    title, content, pinned, createdAt: firebase.firestore.Timestamp.now()
  });
  showToast("å…¬å‘Šå·²æ–°å¢");
  btnClear.click();
  loadAnnouncements();
});

// æ›´æ–°å…¬å‘Š
btnUpdate.addEventListener('click', async ()=>{
  if(!editingDocId) return;
  const title = titleInput.value.trim();
  const content = contentInput.value.trim();
  const pinned = pinnedInput.checked;
  if(!title || !content){ alert("è«‹è¼¸å…¥æ¨™é¡Œèˆ‡å…§å®¹"); return; }

  await db.collection("announcements").doc(editingDocId).update({
    title, content, pinned
  });
  showToast("å…¬å‘Šå·²æ›´æ–°");
  btnClear.click();
  loadAnnouncements();
});
</script>
</body>
</html>

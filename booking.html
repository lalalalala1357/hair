<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>é ç´„ - å¯è‰å…’ Hair Salon</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f9fff9;
    color: #333;
    margin: 0;
    padding: 0;
  }

  header {
    position: fixed;
    top: 0; left: 0; width: 100%;
    background-color: #a8e6cf;
    padding: 20px;
    z-index: 1000;
  }
  header h2 {
    margin: 0;
    color: #4a7c53;
  }

  nav ul {
    list-style: none;
    display: flex;
    gap: 15px;
    padding: 10px 0 0 0;
    margin: 0;
    overflow-x: auto;
    white-space: nowrap;
    -webkit-overflow-scrolling: touch;
  }
  nav li { flex: 0 0 auto; }
  nav a {
    text-decoration: none;
    color: #333;
    font-weight: bold;
    padding: 6px 10px;
    border-radius: 4px;
    display: inline-block;
  }
  nav a:hover,
  nav a.active {
    background-color: #7bd8a2;
    color: white;
  }

  main {
    max-width: 1000px;
    margin: 140px auto 40px;
    padding: 0px 20px;
  }

  h1 {
    color: #4a7c53;
    margin-bottom: 20px;
    text-align: center;
  }

  form {
    background: #fff;
    padding: 20px 40px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    max-width: 500px;
    margin: 0 auto;
  }

  label {
    display: block;
    margin-bottom: 8px;
    font-weight: bold;
    color: #4a7c53;
  }

  select, input {
    width: 100%;
    padding: 10px;
    margin-bottom: 20px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 1rem;
  }

  button {
    background-color: #7bd8a2;
    border: none;
    color: white;
    padding: 12px 20px;
    border-radius: 6px;
    font-size: 1.1rem;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  button:hover {
    background-color: #5bb174;
  }

  footer {
    margin-top: 60px;
    background: #a8e6cf;
    padding: 20px;
    text-align: center;
    font-size: 0.9rem;
  }

  footer a,
  footer a:visited {
    color: #333;
    text-decoration: none;
    margin: 0 8px;
  }

  footer a:hover {
    color: #4a7c53;
  }

  /* --- â–¼â–¼â–¼ é ç´„æˆåŠŸå½ˆçª—æ¨£å¼ â–¼â–¼â–¼ --- */
  #successModal {
    display: none; /* é è¨­éš±è— */
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.6); /* åŠé€æ˜é»‘è‰²èƒŒæ™¯ */
    z-index: 9999;
    justify-content: center; align-items: center;
    backdrop-filter: blur(3px);
  }
  .success-box {
    background: white; padding: 30px 20px; border-radius: 16px;
    text-align: center; max-width: 90%; width: 320px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    animation: popIn 0.3s ease-out;
  }
  @keyframes popIn {
    from { transform: scale(0.8); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }

  .line-btn {
    display: flex; align-items: center; justify-content: center; gap: 8px;
    background: #06c755; color: white;
    text-decoration: none; padding: 12px 20px; border-radius: 50px;
    font-weight: bold; margin: 15px 0; font-size: 1rem;
    box-shadow: 0 4px 10px rgba(6, 199, 85, 0.3);
    transition: transform 0.1s;
  }
  .line-btn:active { transform: scale(0.95); }
  
  .close-text-btn {
    background: none; border: none; color: #999; 
    text-decoration: underline; cursor: pointer; font-size: 0.9rem;
  }
</style>
</head>
<body>

<header>
  <h2>å¯è‰å…’ Hair Salon</h2>
  <nav>
    <ul>
      <li><a href="index.html">é¦–é </a></li>
      <li><a href="about.html">é—œæ–¼æˆ‘å€‘</a></li>
      <li><a href="services.html">æœå‹™é …ç›®</a></li>
      <li><a href="pricing.html">åƒ¹ç›®è¡¨</a></li>
      <li><a href="booking.html" class="active">é ç´„</a></li>
      <li><a href="news.html">æœ€æ–°æ¶ˆæ¯</a></li>
      <li><a href="contact.html">è¯çµ¡æˆ‘å€‘</a></li>
    </ul>
  </nav>
</header>

<main>
  <h1>ç·šä¸Šé ç´„</h1>
  <form id="booking-form">
    <label for="service">æœå‹™é …ç›®</label>
    <select id="service" name="service" required>
      <option value="" disabled selected>è«‹é¸æ“‡æœå‹™</option>
      <option value="å‰ªé«®">å‰ªé«®ï¼ˆç´„1å°æ™‚ï¼‰</option>
      <option value="æ´—é«®">æ´—é«®ï¼ˆç´„1å°æ™‚ï¼‰</option>
      <option value="ç‡™é«®">ç‡™é«®ï¼ˆç´„1å°æ™‚ï¼‰</option>
      <option value="æŸ“é«®">æŸ“é«®ï¼ˆç´„1å°æ™‚ï¼‰</option>
    </select>
    
    <label for="date">æ—¥æœŸ</label>
    <input type="date" id="date" name="date" required />
    
    <label for="time">æ™‚é–“</label>
    <select id="time" name="time" required>
      <option value="" disabled selected>è«‹é¸æ“‡æ™‚é–“</option>
      <option>10:00</option>
      <option>11:00</option>
      <option>13:00</option>
      <option>14:00</option>
      <option>15:00</option>
      <option>16:00</option>
      <option>17:00</option>
      <option>18:00</option>
      <option>19:00</option>
    </select>
    
    <label for="name">å§“å</label>
    <input type="text" id="name" name="name" placeholder="è«‹è¼¸å…¥å§“å" required />
    
    <label for="phone">é›»è©±</label>
    <input type="tel" id="phone" name="phone" placeholder="è«‹è¼¸å…¥é›»è©±" required />
    
    <button type="submit">é€å‡ºé ç´„</button>
  </form>
</main>

<footer>
  Â© 2025 å¯è‰å…’ Hair Salon <br>
  åœ°å€ï¼š514 å½°åŒ–ç¸£æºªæ¹–é®äºŒæºªè·¯ä¸€æ®µ329å··30è™Ÿ <br>
  é›»è©±ï¼š<a href="tel:0988528051">0988-528-051</a><br>
  ç‡Ÿæ¥­æ™‚é–“ï¼šé€±ä¸€è‡³é€±æ—¥ 11:00â€“20:00<br>
  <a href="https://www.facebook.com/share/17SjkpTezD/?mibextid=wwXIfr" target="_blank">Facebook</a> ï½œ 
  <a href="https://www.instagram.com/bijunzhan?igsh=dmdkbWRvbG1kd3Q0" target="_blank">Instagram</a> ï½œ
  <a href="https://line.me/R/ti/p/@491xwhjb" target="_blank">LINE</a>
</footer>

<div id="successModal">
  <div class="success-box">
    <div style="width:60px; height:60px; background:#e8f5e9; border-radius:50%; margin:0 auto 15px; display:flex; align-items:center; justify-content:center;">
      <span style="font-size:32px; color:#4CAF50;">âœ”</span>
    </div>

    <h2 style="color:#4a7c53; margin:0 0 10px 0;">é ç´„é€å‡ºæˆåŠŸï¼</h2>
    
    <p style="color:#555; font-size: 0.95rem; line-height: 1.6; text-align: left; padding: 0 10px;">
      æˆ‘å€‘æœƒç›¡å¿«ç¢ºèªæ‚¨çš„é ç´„ã€‚<br>
      <span style="color:#d9534f; font-weight:bold;">âš ï¸ é‡è¦æ­¥é©Ÿ</span><br>
      è«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•ï¼Œä¸¦æŒ‰ä¸‹<b>ã€Œå‚³é€ã€</b>ï¼Œé€™æ¨£æˆ‘å€‘æ‰èƒ½çŸ¥é“æ‚¨çš„ LINE å¸³è™Ÿï¼Œä»¥å…æ¼æ¥é€šçŸ¥ï¼
    </p>
    
    <a href="#" target="_blank" class="line-btn" id="lineBtn">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="white"><path d="M20.2 9.8c0-4.6-4.5-8.3-10-8.3S0.2 5.2 0.2 9.8c0 4.1 3.6 7.5 8.4 8.2.3.1.8.2.9.5l-0.3 1.9c-0.1 0.5-0.5 1.2 1.1 0.6 0 0 5.8-3.4 8.1-5.9 1.1-1.3 1.8-2.9 1.8-4.6z"/></svg>
      é»æˆ‘å‚³é€èº«åˆ†ç¢ºèª
    </a>
    
    <button class="close-text-btn" onclick="document.getElementById('successModal').style.display='none'">
      æˆ‘å·²ç¶“å‚³éäº†ï¼Œé—œé–‰
    </button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
  // æ‚¨çš„ GAS ç¶²å€ (ç¶­æŒä¸è®Š)
  const LINE_API_URL = "https://script.google.com/macros/s/AKfycbzS0CAd3OX2iNJ3kqt8kx3bvCYe7-MPSdeXPtkXA-mjrR6lUJELJX3A0EH-KDRkJoPKaQ/exec";
  
  const firebaseConfig = {
    apiKey: "AIzaSyCfxDOOzTLbmQRfvW275hJrtOnX_t-6-yc",
    authDomain: "hsinformation.firebaseapp.com",
    projectId: "hsinformation",
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const bookingForm = document.getElementById('booking-form');
  const dateInput = document.getElementById('date');
  const timeSelect = document.getElementById('time');
  const allTimes = ["10:00","11:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00"];

  const today = new Date();
  const year = today.getFullYear();
  const month = String(today.getMonth() + 1).padStart(2, '0');
  const day = String(today.getDate()).padStart(2, '0');
  const todayString = `${year}-${month}-${day}`;

  dateInput.min = todayString;

  dateInput.addEventListener('change', async () => {
    const selectedDate = dateInput.value;
    if (!selectedDate) return;

    const snapshot = await db.collection('appointments')
      .where('date', '==', selectedDate)
      .get();
    const bookedTimes = snapshot.docs.map(doc => doc.data().time);

    const now = new Date();
    const currentHour = now.getHours();
    const isToday = (selectedDate === todayString);

    timeSelect.innerHTML = '<option value="" disabled selected>è«‹é¸æ“‡æ™‚é–“</option>';

    allTimes.forEach(time => {
      const option = document.createElement('option');
      option.value = time;
      
      const timeHour = parseInt(time.split(':')[0]);
      const isPastTime = isToday && (timeHour <= currentHour);
      const isBooked = bookedTimes.includes(time);

      if (isPastTime) {
        option.textContent = `${time} (å·²è¶…éæ™‚é–“)`;
        option.disabled = true;
        option.style.color = '#ccc';
      } else if (isBooked) {
        option.textContent = `${time} (å·²è¢«é ç´„)`;
        option.disabled = true;
        option.style.color = '#ccc';
      } else {
        option.textContent = time;
      }

      timeSelect.appendChild(option);
    });
  });

  // --- é€å‡ºé ç´„ ---
  bookingForm.addEventListener('submit', async e => {
    e.preventDefault();

    const service = document.getElementById('service').value;
    const date = document.getElementById('date').value;
    const time = document.getElementById('time').value;
    const name = document.getElementById('name').value;
    const phone = document.getElementById('phone').value;
    
    const submitBtn = bookingForm.querySelector('button');
    submitBtn.disabled = true;
    submitBtn.textContent = "è™•ç†ä¸­...";

    try {
        const snapshot = await db.collection('appointments')
          .where('date', '==', date)
          .where('time', '==', time)
          .get();

        if (!snapshot.empty) {
          alert("âŒ æ­¤æ™‚é–“å‰›å‰›å·²è¢«æ¶èµ°ï¼Œè«‹é¸æ“‡å…¶ä»–æ™‚æ®µ");
          submitBtn.disabled = false;
          submitBtn.textContent = "é€å‡ºé ç´„";
          return;
        }

        await db.collection('appointments').add({
          memberName: name,
          memberId: phone,
          service: service,
          date: date,
          time: time,
          status: 'å·²é ç´„',
          note: '',
          createdAt: new Date()
        });

        const msg = `ã€æ–°é ç´„é€šçŸ¥ã€‘\nğŸ“… æ—¥æœŸ: ${date}\nâ° æ™‚é–“: ${time}\nğŸ‘¤ å®¢æˆ¶: ${name}\nğŸ“ é›»è©±: ${phone}\nğŸ’‡ é …ç›®: ${service}`;
        
        fetch(LINE_API_URL, {
          method: 'POST',
          mode: 'no-cors',
          body: JSON.stringify({ message: msg }),
          headers: { 'Content-Type': 'application/json' }
        }).catch(err => console.error('LINE é€šçŸ¥å¤±æ•—', err));

        // â˜…â˜…â˜… 4. é—œéµä¿®æ”¹ï¼šå‹•æ…‹ç”Ÿæˆã€Œå¸¶åå­—çš„ã€LINE é€£çµ â˜…â˜…â˜…
        
        // å–å¾—å®¢äººå‰›å‰›å¡«çš„åå­—
        const userName = document.getElementById('name').value;
        
        // çµ„åˆè¨Šæ¯ï¼š "ä½ å¥½ï¼Œæˆ‘æ˜¯ [åå­—]ï¼Œæˆ‘å‰›é ç´„äº†ï¼è«‹ç¢ºèª"
        // ä½¿ç”¨ encodeURIComponent è™•ç†ä¸­æ–‡ï¼Œé¿å…é€£çµå£æ‰
        const lineMessage = `ä½ å¥½ï¼Œæˆ‘æ˜¯ ${userName}ï¼Œæˆ‘å‰›é ç´„äº†ï¼è«‹ç¢ºèªã€‚`;
        const lineUrl = `https://line.me/R/oaMessage/@491xwhjb/?${encodeURIComponent(lineMessage)}`;
        
        // æŠŠé€™å€‹é€£çµå¡é€²æŒ‰éˆ•è£¡
        document.getElementById('lineBtn').href = lineUrl;

        // é¡¯ç¤ºå½ˆçª—
        document.getElementById('successModal').style.display = 'flex';
        
        bookingForm.reset();
        timeSelect.innerHTML = '<option value="" disabled selected>è«‹é¸æ“‡æ™‚é–“</option>';

    } catch (error) {
        console.error(error);
        alert("ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦");
    } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = "é€å‡ºé ç´„";
    }
  });
</script>

</body>
</html>
